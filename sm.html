<!DOCTYPE html>
<html>
  <head>
    <title>摄像头条形码识别</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode"></script>
  </head>
  <body>
    <video id="video" width="640" height="480" autoplay></video>
    <canvas id="canvas" style="display:none;"></canvas>
    
    <script>
      // 获取video元素
      var video = document.getElementById('video');
      
      // 检测浏览器是否支持getUserMedia
      if (navigator.mediaDevices.getUserMedia) {
        navigator.mediaDevices.getUserMedia({ video: true })
          .then(function(stream) {
            video.srcObject = stream;
          })
          .catch(function(error) {
            console.log("无法获取摄像头视频流：" + error);
          });
      }
      
      // 在视频播放时进行回调
      video.addEventListener('play', function() {
        // 创建一个Canvas元素
        var canvas = document.getElementById('canvas');
        var ctx = canvas.getContext('2d');
        
        // 设置Canvas尺寸和视频尺寸相等
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        
        // 定时进行条形码识别
        setInterval(function() {
          // 将当前视频帧绘制到Canvas上
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
          
          // 读取条形码数据
          var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          var barcode = jsQR(imageData.data, imageData.width, imageData.height);
          
          // 输出识别结果
          if (barcode) {
            console.log('识别到的条形码：', barcode.data);
          } else {
            console.log('未能识别到条形码');
          }
        }, 1000); // 每秒进行一次识别，可以根据需要调整时间间隔
      });
    </script>
  </body>
</html>
